!function(e){var t={};function n(o){if(t[o])return t[o].exports;var a=t[o]={i:o,l:!1,exports:{}};return e[o].call(a.exports,a,a.exports,n),a.l=!0,a.exports}n.m=e,n.c=t,n.d=function(e,t,o){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:o})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var o=Object.create(null);if(n.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)n.d(o,a,function(t){return e[t]}.bind(null,a));return o},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t){e.exports='<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <meta name="viewport" content="width=device-width,initial-scale=1"/> <title>Notion Backups</title> <style>.container{width:100%;height:100vh;background:#fff;display:flex;align-items:center;justify-content:center}.description{padding:13px 40px;box-shadow:0 0 10px 10px #f2fff2;color:rgb(0 122 40 / 32%);background-color:#045b001a;font-size:24pt;border:1px solid;border-radius:13px;font-family:system-ui}</style> </head> <body> <div class="container"> <div class="description"> The script is running! </div> </div> </body> </html> '},function(e,t){e.exports='<!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8"/> <meta http-equiv="X-UA-Compatible" content="IE=edge"/> <meta name="viewport" content="width=device-width,initial-scale=1"/> <title>Notion Backups</title> <style>.container{width:100%;height:100vh;background:#fff;display:flex;align-items:center;justify-content:center}.description{padding:13px 40px;box-shadow:0 0 10px 10px #ffeaea;color:rgba(191,0,0,.319);background-color:#ff00001a;font-size:24pt;border:1px solid;border-radius:13px;font-family:system-ui}</style> </head> <body> <div class="container"> <div class="description"> TOKEN_V2 is required </div> </div> </body> </html> '},function(e,t,n){"use strict";n.r(t);const o=globalThis.TOKEN_V2,a="https://www.notion.so/api/v3",i={Cookie:`token_v2=${void 0!==typeof o?o:""};`,"Content-Type":"application/json"},r=e=>new Promise(async(t,n)=>{try{const o=await(async e=>{const t={task:{eventName:"exportSpace",request:{spaceId:e,exportOptions:{exportType:"undefined"!=typeof EXPORT_TYPE?EXPORT_TYPE:"html",timeZone:"undefined"!=typeof TIMEZONE?TIMEZONE:"Etc/UTC",locale:"undefined"!=typeof LOCALE?LOCALE:"en"}}}},n=await fetch(a+"/enqueueTask",{method:"POST",body:JSON.stringify(t),headers:i}),{taskId:o}=await n.json();return o})(e.id),r=setInterval(async()=>{const s=await(async e=>{const t=await fetch(a+"/getTasks",{method:"POST",body:JSON.stringify({taskIds:[e]}),headers:i});return(await t.json()).results[0].status})(o);if(s){if("complete"===s.type){clearInterval(r);const n={...e,url:s.exportURL};t(n)}}else clearInterval(r),n(new Error(`Failed to export ${e.name} workspace`))},5e3)}catch(e){console.error(e),n(new Error("Something went wrong"))}}),s=async()=>{const e=(await(async()=>{const e=await fetch(a+"/getSpaces",{method:"POST",headers:i}),t=await e.json(),n=t[Object.keys(t)[0]].space;return Object.keys(n).map(e=>({id:n[e].value.id,name:n[e].value.name}))})()).map(e=>r(e));return Promise.allSettled(e)},c=()=>{const e=new Date;return`${e.getFullYear()}-${e.getMonth()+1}-${e.getDate()} -- ${e.getHours()}:${e.getMinutes()}`},d=async e=>{try{"undefined"!=typeof SLACK_WEBHOOK&&await(async e=>{const t={blocks:[{type:"header",text:{type:"plain_text",text:"💾 Backup: "+c(),emoji:!0}},{type:"divider"},...e.map(e=>(e=>({type:"section",text:{type:"mrkdwn",text:"fulfilled"===e.status?e.value.name+" workspace `✅ Success`":e.reason+" `❌ Failed`"},accessory:{type:"button",text:{type:"plain_text",text:"Download",emoji:!0},value:"download",url:"fulfilled"===e.status?e.value.url:"https://youtu.be/dQw4w9WgXcQ",action_id:"button-action"}}))(e)),{type:"divider"}]};await fetch(SLACK_WEBHOOK,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})})(e),"undefined"!=typeof DISCORD_WEBHOOK&&await(async e=>{const t={username:"Notion Backups",content:`> 💾 **Backup: ${c()}**`,embeds:[...e.map(e=>({color:5763719,author:{name:"fulfilled"===e.status?e.value.name+" workspace":"❌ Failed: "+e.reason},title:"Download",url:"fulfilled"===e.status?e.value.url:"https://youtu.be/dQw4w9WgXcQ"}))]};await fetch(DISCORD_WEBHOOK,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})})(e)}catch(e){throw console.error(e),new Error("failed to send notification")}},l=async e=>{try{"undefined"!=typeof SLACK_WEBHOOK&&await(async e=>{const t={blocks:[{type:"section",text:{type:"mrkdwn",text:e}}]};await fetch(SLACK_WEBHOOK,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})})(e),"undefined"!=typeof DISCORD_WEBHOOK&&await(async e=>{const t={username:"Logs",content:e};await fetch(DISCORD_WEBHOOK,{method:"POST",body:JSON.stringify(t),headers:{"Content-Type":"application/json"}})})(e)}catch(e){throw console.error(e),new Error("failed to send notification")}},p=async()=>{try{if("undefined"==typeof TOKEN_V2)return;console.log("Start",TOKEN_V2);const e="📡 *log*: starting the backup process\n";await l(e);const t=await s();await d(t)}catch(e){console.error(e)}};var u=n(0),f=n.n(u),y=n(1),h=n.n(y);addEventListener("fetch",e=>{e.respondWith(async function(e){const{pathname:t}=new URL(e.url);if("undefined"==typeof TOKEN_V2)return new Response(h.a,{headers:{"content-type":"text/html"}});"/test"===t&&"undefined"!=typeof MODE&&"test"==MODE&&await p();return new Response(f.a,{headers:{"content-type":"text/html"}})}(e.request))}),addEventListener("scheduled",e=>{e.waitUntil(p())})}]);